<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Home - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li  class="active" >
        <a href="index.html">
          
          
            <svg fill="#0095dd" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Log4-Microservice Reference v1.0.0
    </h3>

    

    <h3>Classes</h3><ul><li id="BaseLogger-nav"><a href="global.html#BaseLogger">BaseLogger</a></li><li id="BunyanAdapter-nav"><a href="BunyanAdapter.html">BunyanAdapter</a><ul class='methods'><li data-type="method" id="BunyanAdapter-configure-nav"><a href="BunyanAdapter.html#configure">configure</a></li><li data-type="method" id="BunyanAdapter-debug-nav"><a href="BunyanAdapter.html#debug">debug</a></li><li data-type="method" id="BunyanAdapter-error-nav"><a href="BunyanAdapter.html#error">error</a></li><li data-type="method" id="BunyanAdapter-getTransports-nav"><a href="BunyanAdapter.html#getTransports">getTransports</a></li><li data-type="method" id="BunyanAdapter-getWriteableStream-nav"><a href="BunyanAdapter.html#getWriteableStream">getWriteableStream</a></li><li data-type="method" id="BunyanAdapter-info-nav"><a href="BunyanAdapter.html#info">info</a></li></ul></li><li id="Log4Microservice-nav"><a href="Log4Microservice.html">Log4Microservice</a></li><li id="LoggerFactory-nav"><a href="LoggerFactory.html">LoggerFactory</a><ul class='methods'><li data-type="method" id="LoggerFactory-getAdapter-nav"><a href="LoggerFactory.html#.getAdapter">getAdapter</a></li></ul></li><li id="PinoAdapter-nav"><a href="PinoAdapter.html">PinoAdapter</a><ul class='methods'><li data-type="method" id="PinoAdapter-configure-nav"><a href="PinoAdapter.html#configure">configure</a></li><li data-type="method" id="PinoAdapter-debug-nav"><a href="PinoAdapter.html#debug">debug</a></li><li data-type="method" id="PinoAdapter-error-nav"><a href="PinoAdapter.html#error">error</a></li><li data-type="method" id="PinoAdapter-getTransports-nav"><a href="PinoAdapter.html#getTransports">getTransports</a></li><li data-type="method" id="PinoAdapter-getWriteableStream-nav"><a href="PinoAdapter.html#getWriteableStream">getWriteableStream</a></li><li data-type="method" id="PinoAdapter-info-nav"><a href="PinoAdapter.html#info">info</a></li></ul></li><li id="WinstonAdapter-nav"><a href="WinstonAdapter.html">WinstonAdapter</a><ul class='methods'><li data-type="method" id="WinstonAdapter-configure-nav"><a href="WinstonAdapter.html#configure">configure</a></li><li data-type="method" id="WinstonAdapter-debug-nav"><a href="WinstonAdapter.html#debug">debug</a></li><li data-type="method" id="WinstonAdapter-error-nav"><a href="WinstonAdapter.html#error">error</a></li><li data-type="method" id="WinstonAdapter-getTransports-nav"><a href="WinstonAdapter.html#getTransports">getTransports</a></li><li data-type="method" id="WinstonAdapter-info-nav"><a href="WinstonAdapter.html#info">info</a></li></ul></li></ul><h3 id="global-nav"><a href="global.html">Global</a></h3>
  </nav>

  <div id="main">
    

    
      



    

      


  <section class="readme">
    <article>
      <h1>log4-microservice</h1>
<p>LoggerSDK for Microservices with multiple adapters eg: Pino, Winston, Bunyan.</p>
<h3>Installation</h3>
<pre class="prettyprint source"><code>  npm install log4-microservice --save
</code></pre>
<h3>Configuration Required</h3>
<pre class="prettyprint source"><code>  process.env.SERVICE = 'Payment'; // Name of the microservice
  process.env.LOG_ADAPTER = 'pino'; // any one of the pino, winston, bunyan values
  process.env.LOG_LEVEL = 'debug';
  process.env.LOG_PATH = 'logs'; // log directory path
  process.env.LOG_FILE = 'payment.log'; // log file name
</code></pre>
<h3>Usage</h3>
<ul>
<li>Step1 : Configure</li>
</ul>
<pre class="prettyprint source"><code>  // Entry Point of your Microservice
  // server.js
  const Logger = require('log4-microservice');

  // Typescript
  // import * as Logger from 'log4-microservice'

  //...other initialization code
  function configureLogger() {
    const logOptions = {
      level: process.env.LOG_LEVEL,
      logPath: process.env.LOG_PATH,
      logFile: process.env.LOG_FILE,
  };

  Logger.setLoggerOptions(logOptions);
  Logger.addAdapter(process.env.LOG_ADAPTER, MLogger.setAdapter(process.env.LOG_ADAPTER));
}

// should be configured once hence in entry point file
configureLogger();

</code></pre>
<ul>
<li>Step2 : Create instances</li>
</ul>
<pre class="prettyprint source"><code>// mymodule.js
const Logger = require('log4-microservice');
const logger = new Logger('mymodule');
logger.debug('debug');
logger.info('info');
logger.error(new Error());
logger.log('level', msg, arbitarydata, correlationIdJson)
</code></pre>
<p>NOTE: scope will be truncated to first 6 chars for formatting.</p>
<h3>CorrelationIds</h3>
<p>In order to add the correlationIds often known as MDC (Mapped Domain Context or Context Mapping) related to specific event it can be supplied to any of the loggers API as the last argument. CorrelationId should be a valid JSON Object. Incase if correlationIds are not passed on default correlationIds assigned during instantiation will be used.</p>
<h4>Motive for implementing MDC</h4>
<p>Often when there are lot of microservices and logs are been forwarded it becomes difficult to find the reason for error and sequence of events that might have caused the error. MDC approach helps to group together the events that are related to specific event for eg. Order Checkout failed or Payment Failure on Ecommerce site.As customer is unaware of the internal things it is wise idea to add some related information as correlationIds like { orderID: 101 } so it can be searched quickly.</p>
<h4>Usage of CorrelationIds</h4>
<pre class="prettyprint source"><code> processPayment(orderData) {
   logger.debug(`Processing payment for orderID ${orderData.id}`, { orderId: orderData.id });
 }
</code></pre>
<h4>Run Examples</h4>
<pre class="prettyprint source"><code>  node examples server.js
</code></pre>
<h4>Setup Requirement For New Relic Integration</h4>
<ul>
<li>Install td-agent 4 <a href="https://docs.fluentd.org/installation/install-by-deb">Installation</a></li>
<li>Configure td-agent.conf in /etc/td-agent/td-agent.conf</li>
</ul>
<pre class="prettyprint source"><code>&lt;source>
  @type tail
  path /tmp/logs/payment.log
  tag payment.stdout
  pos_file /tmp/payment.log.pos
  &lt;parse>
    @type json
  &lt;/parse>
&lt;/source>

&lt;match payment.stdout>
  @type http
  log_level debug
  endpoint https://log-api.eu.newrelic.com/log/v1
  http_method post
  content_type application/json
  headers {&quot;x-license-key&quot;:&quot;ENTER_LICENSE_KEY&quot; }
  &lt;format>
      @type json
  &lt;/format>
  &lt;buffer>
    flush_interval 2s
  &lt;/buffer>
&lt;/match>
</code></pre>
<hr>
<p>HappyCoding :bowtie:</p>
    </article>
  </section>


    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>